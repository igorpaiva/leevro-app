<section class="books-section">
  <div class="books-container">
    <!-- Header -->
    <div class="books-header">
      <div class="header-left">
        <button mat-icon-button class="back-button" (click)="goBackToDashboard()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="title-section">
          <h1 class="books-title">{{ pageTitle }}</h1>
          <p class="books-subtitle">Manage your reading collection</p>
        </div>
      </div>
      
      <div class="header-actions">
        <button mat-icon-button (click)="toggleSortDirection()" 
                [title]="'Sort ' + (sortDirection === 'asc' ? 'Descending' : 'Ascending')">
          <mat-icon>{{sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward'}}</mat-icon>
        </button>
        <button mat-icon-button [class.active]="viewMode === 'grid'" (click)="viewMode = 'grid'">
          <mat-icon>grid_view</mat-icon>
        </button>
        <button mat-icon-button [class.active]="viewMode === 'list'" (click)="viewMode = 'list'">
          <mat-icon>view_list</mat-icon>
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <div class="search-bar">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search books...</mat-label>
          <input matInput [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="Title, author, or ISBN">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
      
      <div class="filter-options">
        <mat-form-field appearance="outline" class="status-filter">
          <mat-label>Filter by status</mat-label>
          <mat-select [(value)]="filterStatus" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let option of statusOptions" [value]="option.value">
              {{option.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Reading Statistics -->
    <div *ngIf="!loading" class="reading-stats">
      <div class="stats-grid">
        <div class="stat-card">
          <mat-icon>menu_book</mat-icon>
          <div class="stat-info">
            <span class="stat-number">{{getReadingStats().read}}</span>
            <span class="stat-label">Books Read</span>
          </div>
        </div>
        <div class="stat-card">
          <mat-icon>favorite</mat-icon>
          <div class="stat-info">
            <span class="stat-number">{{getReadingStats().favorites}}</span>
            <span class="stat-label">Favorites</span>
          </div>
        </div>
        <div class="stat-card">
          <mat-icon>library_books</mat-icon>
          <div class="stat-info">
            <span class="stat-number">{{getReadingStats().owned}}</span>
            <span class="stat-label">Owned</span>
          </div>
        </div>
        <div class="stat-card">
          <mat-icon>bookmark</mat-icon>
          <div class="stat-info">
            <span class="stat-number">{{getReadingStats().wishlist}}</span>
            <span class="stat-label">Wishlist</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-section">
      <mat-spinner></mat-spinner>
      <p>Loading your books...</p>
    </div>

    <!-- Books Grid View -->
    <div *ngIf="!loading && viewMode === 'grid'" class="books-grid">
      <div *ngFor="let book of filteredBooks" class="book-card" (click)="viewBookDetails(book)">
        <div class="book-cover">
          <img [src]="getBookCoverUrl(book)" 
               [alt]="book.title" 
               (error)="onImageError($event)"
               loading="lazy">
          <div class="book-overlay">
            <div class="book-actions">
              <button mat-mini-fab color="primary" (click)="addToReading(book); $event.stopPropagation()">
                <mat-icon>add</mat-icon>
              </button>
              <button mat-mini-fab [color]="book.id && isBookFavorite(book.id) ? 'warn' : 'accent'" 
                      (click)="toggleFavorite(book); $event.stopPropagation()" *ngIf="book.id">
                <mat-icon>{{isBookFavorite(book.id) ? 'favorite' : 'favorite_border'}}</mat-icon>
              </button>
            </div>
          </div>
        </div>
        
        <div class="book-info">
          <h3 class="book-title">{{book.title}}</h3>
          <p class="book-author">by {{formatAuthors(book.authors)}}</p>
          <div class="book-meta">
            <span class="pages">{{book.numberOfPages}} pages</span>
            <span class="status-badge" [class]="getBookStatus(book.id).toLowerCase()" *ngIf="book.id">
              {{getBookStatus(book.id).replace('_', ' ')}}
            </span>
          </div>
          <div *ngIf="book.id && getBookRating(book.id) > 0" class="book-rating">
            <mat-icon *ngFor="let star of [1,2,3,4,5]" 
                     [class.filled]="star <= getBookRating(book.id)">star</mat-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Books List View -->
    <div *ngIf="!loading && viewMode === 'list'" class="books-list">
      <div *ngFor="let book of filteredBooks" class="book-list-item" (click)="viewBookDetails(book)">
        <div class="book-cover-small">
          <img [src]="getBookCoverUrl(book)" 
               [alt]="book.title" 
               (error)="onImageError($event)"
               loading="lazy">
        </div>
        
        <div class="book-details">
          <div class="book-main-info">
            <h3 class="book-title">{{book.title}}</h3>
            <p class="book-author">by {{formatAuthors(book.authors)}}</p>
            <p class="book-description">{{book.description}}</p>
          </div>
          
          <div class="book-meta-info">
            <div class="meta-item">
              <mat-icon>menu_book</mat-icon>
              <span>{{book.numberOfPages}} pages</span>
            </div>
            <div class="meta-item">
              <mat-icon>calendar_today</mat-icon>
              <span>{{book.releaseDate | date:'yyyy'}}</span>
            </div>
            <div class="meta-item">
              <mat-icon>label</mat-icon>
              <span class="status-badge" [class]="getBookStatus(book.id).toLowerCase()" *ngIf="book.id">
                {{getBookStatus(book.id).replace('_', ' ')}}
              </span>
            </div>
          </div>
          
          <div *ngIf="book.id && getBookRating(book.id) > 0" class="book-rating">
            <mat-icon *ngFor="let star of [1,2,3,4,5]" 
                     [class.filled]="star <= getBookRating(book.id)">star</mat-icon>
          </div>
        </div>
        
        <div class="book-actions-list" *ngIf="book.id">
          <button mat-icon-button color="primary" (click)="addToReading(book); $event.stopPropagation()">
            <mat-icon>add</mat-icon>
          </button>
          <button mat-icon-button [color]="isBookFavorite(book.id) ? 'warn' : 'accent'" 
                  (click)="toggleFavorite(book); $event.stopPropagation()">
            <mat-icon>{{isBookFavorite(book.id) ? 'favorite' : 'favorite_border'}}</mat-icon>
          </button>
          <button mat-icon-button color="accent" (click)="markAsCompleted(book); $event.stopPropagation()">
            <mat-icon>check_circle</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Pagination Controls -->
    <div *ngIf="!loading && totalPages > 1" class="pagination-section">
      <div class="pagination-info">
        <span>Showing {{(currentPage * pageSize) + 1}} to {{getEndItem()}} of {{totalElements}} books</span>
      </div>
      
      <div class="pagination-controls">
        <button mat-icon-button [disabled]="isFirst" (click)="previousPage()" class="pagination-btn">
          <mat-icon>chevron_left</mat-icon>
        </button>
        
        <div class="page-numbers">
          <button *ngFor="let page of getPaginationArray()" 
                  mat-stroked-button 
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)"
                  class="page-btn">
            {{page + 1}}
          </button>
        </div>
        
        <button mat-icon-button [disabled]="isLast" (click)="nextPage()" class="pagination-btn">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
      
      <div class="page-size-selector">
        <mat-form-field appearance="outline" class="page-size-field">
          <mat-label>Items per page</mat-label>
          <mat-select [value]="pageSize" (selectionChange)="changePageSize($event.value)">
            <mat-option [value]="8">8</mat-option>
            <mat-option [value]="16">16</mat-option>
            <mat-option [value]="32">32</mat-option>
            <mat-option [value]="64">64</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && filteredBooks.length === 0" class="empty-state">
      <mat-icon class="empty-icon">menu_book</mat-icon>
      <h2>No books found</h2>
      <p>Try adjusting your search or filter criteria</p>
    </div>
  </div>
</section>
